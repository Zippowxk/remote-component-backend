{"version":3,"sources":["webpack:///./src/views/freepwdPay/freesubmit.vue?f5e2","webpack:///src/views/freepwdPay/freesubmit.vue","webpack:///./src/views/freepwdPay/freesubmit.vue?fb5b","webpack:///./src/views/freepwdPay/freesubmit.vue","webpack:///./src/views/freepwdPay/freesubmit.vue?afa0"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","title","_v","_s","phone","formatter","scopedSlots","_u","key","fn","class","canCode","on","getCode","codeText","proxy","model","value","callback","$$v","sms","expression","doHelp","doSubmit","staticRenderFns","name","components","Header","data","fromFlag","bankcardInfo","fetching","computed","mounted","$route","query","addcard","substr","fetchBankCardInfo","sessionStorage","getItem","leftCountTimer","$router","replace","methods","test","verify_code","card_no","getBankRegInfo","mobile_no","id_type","id_no","holder_name","verify_code_no","bank_code","bankNo","bank_name","bankName","bank_tel","bankPhone","signSource","card_type","params","card_expired_date","card_exdate_text","card_cvv2","$http","post","result","success","$toast","setItem","$dialog","alert","message","then","count","clearInterval","timer","run","get","bankNames","component"],"mappings":"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","file":"js/chunk-b9c1375e.763bdff6.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('Header',{attrs:{\"text\":_vm.title}}),_c('div',{staticClass:\"submit-page\"},[_c('p',[_vm._v(\"验证码已经发送到 \"+_vm._s(_vm.phone))]),_c('van-field',{attrs:{\"type\":\"digit\",\"center\":\"\",\"clearable\":\"\",\"label\":\"短信验证码\",\"placeholder\":\"请输入短信验证码\",\"maxlength\":\"6\",\"formatter\":_vm.formatter},scopedSlots:_vm._u([{key:\"button\",fn:function(){return [_c('a',{staticClass:\"code-btn\",class:{'active': _vm.canCode},attrs:{\"href\":\"javascript:;\"},on:{\"click\":_vm.getCode}},[_vm._v(_vm._s(_vm.codeText))])]},proxy:true}]),model:{value:(_vm.sms),callback:function ($$v) {_vm.sms=$$v},expression:\"sms\"}}),_c('div',{staticClass:\"submit-help\"},[_c('a',{attrs:{\"href\":\"javascript:;\"},on:{\"click\":_vm.doHelp}},[_vm._v(\"收不到验证码？\")])]),_c('div',{staticClass:\"submit-btn\",class:{'active': _vm.sms}},[_c('a',{attrs:{\"href\":\"javascript:;\"},on:{\"click\":_vm.doSubmit}},[_vm._v(\"确定\")]),_c('p',[_vm._v(\"本服务由中国工商银行服务\")])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"content\">\n    <Header :text=\"title\"></Header>\n    <div class=\"submit-page\">\n      <p>验证码已经发送到 {{phone}}</p>\n      <van-field\n        v-model=\"sms\"\n        type=\"digit\"\n        center\n        clearable\n        label=\"短信验证码\"\n        placeholder=\"请输入短信验证码\"\n        maxlength=\"6\"\n        :formatter=\"formatter\"\n      >\n        <template #button>\n          <a href=\"javascript:;\" class=\"code-btn\" :class=\"{'active': canCode}\" @click=\"getCode\">{{codeText}}</a>\n        </template>\n      </van-field>\n      <div class=\"submit-help\">\n        <a href=\"javascript:;\" @click=\"doHelp\">收不到验证码？</a>\n      </div>\n      <div class=\"submit-btn\" :class=\"{'active': sms}\">\n        <a href=\"javascript:;\" @click=\"doSubmit\">确定</a>\n        <p>本服务由中国工商银行服务</p>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport URL from '@/http/url'\nimport Header from '@/components/header'\nimport { mapGetters, mapMutations } from 'vuex'\n\nexport default {\n  name: 'freesubmit',\n  components: {\n    Header,\n  },\n  data() {\n    return {\n      title: '',\n      fromFlag: '', // 来源标识  收银台绑卡 or 免密签约\n      sms: '',\n      phone: '',\n      bankcardInfo: {}, // 银行卡信息\n      canCode: false,\n      codeText: '发送验证码',\n      fetching: false,\n    }\n  },\n  computed: {\n    // ...mapGetters(['mId']),\n    ...mapGetters('freebankcard', ['getBankRegInfo'])\n  },\n  mounted() {\n    let phone = this.getBankRegInfo.mobile_no\n    this.fromFlag = this.$route.query.addcard // 是否是收银台绑卡\n\n    if (this.fromFlag) {\n      this.title = '添加银行卡'\n    } else {\n      this.title = '物联支付签约'\n    }\n\n    if (phone) {\n      this.phone = phone.substr(0, 3) + '****' + phone.substr(7);\n      this.fetchBankCardInfo()\n      if (+sessionStorage.getItem('get_free_code')) {\n        this.leftCountTimer(30)\n      } else {\n        this.canCode = true;\n        this.getCode();\n      }\n    } else {\n      this.$router.replace(this.fromFlag ? '/freeapply?addcard=' + this.fromFlag : '/freeapply')\n    }\n  },\n  methods: {\n    ...mapMutations('freebankcard', ['setFreeMessage', 'setFreeOriginUrl', 'setBankRegInfo']),\n    doSubmit() {\n      if (!this.sms || this.fetching) return\n      if (!/^\\d{6}$/.test(this.sms)) {\n        this.$toast('输入短信验证码位数或格式有误')\n        return\n      }\n      this.fetching = true\n      let params = {\n        // ...this.getBankRegInfo,\n        verify_code: this.sms.replace(/\\s/g, ''),\n        // member_id: this.mId,\n        // uc_user_id: this.getBankRegInfo.uc_user_id,\n        card_no: this.getBankRegInfo.card_no,\n        mobile_no: this.getBankRegInfo.mobile_no,\n        id_type: this.getBankRegInfo.id_type,\n        id_no: this.getBankRegInfo.id_no,\n        holder_name: this.getBankRegInfo.holder_name,\n        verify_code_no: this.getBankRegInfo.verify_code_no,\n        bank_code: this.bankcardInfo.bankNo,\n        bank_name: this.bankcardInfo.bankName,\n        bank_tel: this.bankcardInfo.bankPhone,\n        signSource: this.fromFlag ? 2 : 1,\n      }\n\n      if (this.getBankRegInfo.card_type === 2) {\n        params.card_expired_date = this.getBankRegInfo.card_exdate_text\n        params.card_cvv2 = this.getBankRegInfo.card_cvv2\n      }\n\n      this.$http.post(URL.DO_FREE_BANKCORD, params).then(({ data }) => {\n        let result = data;\n        if (result.success) {\n          this.setFreeOriginUrl(result.data);\n          this.$router.replace(this.fromFlag ? '/freestate?status=1&addcard=' + this.fromFlag : '/freestate?status=1')\n        } else {\n          // this.setFreeMessage(result.message)\n          this.$toast(result.message);\n          this.$router.replace(this.fromFlag ? '/freeapply?addcard=' + this.fromFlag : '/freeapply')\n        }\n      });\n    },\n\n    getCode() {\n      if (!this.canCode) return;\n      let params = {\n        holder_name: this.getBankRegInfo.holder_name,\n        id_no: this.getBankRegInfo.id_no,\n        card_no: this.getBankRegInfo.card_no && this.getBankRegInfo.card_no.replace(/\\s/g, ''),\n        id_type: 0,\n        mobile_no: this.getBankRegInfo.mobile_no,\n      }\n\n      if (this.getBankRegInfo.card_type === 2) {\n        params.card_expired_date = this.getBankRegInfo.card_exdate_text\n        params.card_cvv2 = this.getBankRegInfo.card_cvv2\n      }\n\n      this.$http.post(URL.GET_FREE_CODE_MSG, {\n        ...params\n      }).then(({ data }) => {\n        let result = data;\n        if (result.success) {\n          this.canCode = false;\n          this.leftCountTimer(60)\n          this.setBankRegInfo({\n            verify_code_no: result.data,\n          })\n          sessionStorage.setItem('get_free_code', 1);\n        } else {\n          this.$toast(result.message)\n        }\n      });\n    },\n    doHelp() {\n      if (this.bankcardInfo.bankPhone) {\n        this.$dialog.alert({\n          // allowHtml: true,\n          message: '银行预留手机号是您办理该银行卡时所填写的手机号。如忘记、停用或忘记预留手机号，请拨打银行客服电话 <a href=\"tel:' + this.bankcardInfo.bankPhone + '\" style=\"color: #2283E2;\">' + this.bankcardInfo.bankPhone + '</a>更新处理！',\n        });\n      } else {\n        this.fetchBankCardInfo().then(() => {\n          if (this.bankcardInfo.bankPhone) {\n            this.$dialog.alert({\n              // allowHtml: true,\n              message: '银行预留手机号是您办理该银行卡时所填写的手机号。如忘记、停用或忘记预留手机号，请拨打银行客服电话 <a href=\"tel:' + this.bankcardInfo.bankPhone + '\" style=\"color: #2283E2;\">' + this.bankcardInfo.bankPhone + '</a>更新处理！',\n            });\n          } else {\n            this.$dialog.alert({\n              // allowHtml: true,\n              message: '银行预留手机号是您办理该银行卡时所填写的手机号。如忘记、停用或忘记预留手机号，请拨打银行客服电话更新处理！',\n            });\n          }\n        })\n      }\n    },\n    leftCountTimer(count) {\n      let run = () => {\n        count--;\n        if (count <= 0) {\n          clearInterval(timer);\n          this.codeText = '重新获取';\n          this.canCode = true;\n          sessionStorage.setItem('get_free_code', 0)\n        } else {\n          this.codeText = '重新获取(' + count + 's)'\n        }\n      }\n      let timer = setInterval(run, 1000);\n      run()\n    },\n\n    fetchBankCardInfo() {\n      return this.$http.get(URL.GET_BANKNAME + '?cardNo=' + this.getBankRegInfo.card_no).then(res => {\n        let result = res.data.data\n        if (result.bankNames) { // 能够识别银行卡\n          this.bankcardInfo = {\n            ...result.bankNames,\n            bankPhone: result.bankPhone\n          }\n        } else { // 不能识别\n          this.bankcardInfo = {}\n        }\n      })\n    },\n    formatter(value) {\n      return value.replace(/\\D/g, '');\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.content{\n  padding-top: 1rem;\n}\n.submit-page{\n  padding: .48rem .24rem;\n  >p{\n    padding-bottom: .24rem;\n    color: #999;\n    font-size: .28rem;\n  }\n}\n\n.code-btn{\n  color: #999;\n  &.active{\n    color: #2283E2;\n  }\n}\n\n.submit-help{\n  padding: .24rem 0;\n  text-align: right;\n  a{\n    color: #999;\n    font-size: .24rem;\n  }\n}\n\n.submit-btn{\n  padding-top: .24rem;\n  &.active{\n    a{\n      opacity: 1;\n      background: #2283E2;\n    }\n  }\n  a{\n    display: flex;\n    height: .88rem;\n    justify-content: center;\n    align-items: center;\n    font-size: .32rem;\n    color: #fff;\n    background: #D8D8D8;\n    border-radius: .44rem;\n    opacity: .7;\n  }\n  p{\n    padding: .24rem 0;\n    font-size: .24rem;\n    text-align: center;\n    color: #999;\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./freesubmit.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./freesubmit.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./freesubmit.vue?vue&type=template&id=520a0158&scoped=true&\"\nimport script from \"./freesubmit.vue?vue&type=script&lang=js&\"\nexport * from \"./freesubmit.vue?vue&type=script&lang=js&\"\nimport style0 from \"./freesubmit.vue?vue&type=style&index=0&id=520a0158&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"520a0158\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/@sg/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./freesubmit.vue?vue&type=style&index=0&id=520a0158&lang=scss&scoped=true&\""],"sourceRoot":""}