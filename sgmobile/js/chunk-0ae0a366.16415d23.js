(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0ae0a366"],{5956:function(e,t,n){},8052:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("van-popup",{staticClass:"picture-share",attrs:{"get-container":"#app-warp",position:"bottom"},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[e.showModal?n("div",{staticClass:"picture-share-content",class:{full:"good-class-picture"!==e.currentTab}},[n("div",{staticClass:"title-line"},[e._v(" 画报分享 "),n("img",{staticClass:"close-icon",attrs:{src:e.$cdnImageUrl+"/common/control-close.png",alt:""},on:{click:function(t){return t.stopPropagation(),e.closeModal.apply(null,arguments)}}})]),"store"===e.pageType?n("store-picture"):e._e(),"good"===e.pageType?n("div",{staticClass:"switch-tab",class:{"no-spu":e.noSpu}},[n("van-tabs",{attrs:{color:"#2878FF"},model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}},[n("van-tab",{attrs:{title:"商品主图",name:"good-main-picture"}},[n("good-main-picture",{attrs:{randomkey:e.randomkey}})],1),n("van-tab",{attrs:{title:"商品规格分类",name:"good-class-picture"}},[n("good-class-picture")],1)],1)],1):e._e(),n("div",{staticClass:"save-btn",on:{click:function(t){return t.stopPropagation(),e.savePicture.apply(null,arguments)}}},[e._v("保存图片")])],1):e._e()])},o=[],i=n("a34a"),r=n.n(i),s=n("c0e9"),c=n.n(s);n("5956");function u(e,t,n,a,o,i,r){try{var s=e[i](r),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(a,o)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var i=e.apply(t,n);function r(e){u(i,a,o,r,s,"next",e)}function s(e){u(i,a,o,r,s,"throw",e)}r(void 0)}))}}var p=function(){return Promise.all([n.e("chunk-3a072327"),n.e("chunk-70af4cda")]).then(n.bind(null,"8f2a"))},d=function(){return Promise.all([n.e("chunk-3a072327"),n.e("chunk-72b17dd9")]).then(n.bind(null,"fefe"))},h=function(){return Promise.all([n.e("chunk-3a072327"),n.e("chunk-ae2cc86c")]).then(n.bind(null,"1125"))},g={components:{goodClassPicture:p,goodMainPicture:d,storePicture:h},props:{show:Boolean},data:function(){return{showModal:!1,currentTab:"good-main-picture",pageType:"",noSpu:!0,randomkey:Date.now()}},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{closeModal:function(){this.showModal=!1},init:function(){if("shopDetail"===this.$route.name&&(this.pageType="store"),"detail"===this.$route.name){this.pageType="good";var e=this.$util.strJSONParse(localStorage.getItem("shareMessage"));console.log("localStorage shareMessage",e),e&&(this.noSpu=e.spuList.length<=1)}},savePicture:function(){var e=this;return l(r.a.mark((function t(){var n,a,o,i;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.shareContent(),n){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e._html2canvas();case 5:a=t.sent,console.log("savePicture",a.length),e.$util.isHaierApp()?e.$util.uplusSaveImage(a).then((function(t){t?e.$toast({type:"success",message:"保存成功",duration:1500,className:"picture-toast-class"}):(console.log("uplusSaveImage error:",t),e.$toast({type:"fail",message:"保存失败",duration:1500,className:"picture-toast-class"}))})):e.$util.isSgRn()?window.postMessage(JSON.stringify({type:"saveQrCode",data:{qrCodeUrl:a}})):(o=document.createElement("a"),i=new MouseEvent("click"),o.download=Date.now(),o.href=a,o.dispatchEvent(i)),e.randomkey=Date.now();case 9:case"end":return t.stop()}}),t)})))()},_getPixelRatio:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},_html2canvas:function(){var e=this;return new Promise((function(t,n){var a=e.shareContent(),o=a.offsetWidth,i=a.offsetHeight,s=document.createElement("canvas"),u=s.getContext("2d"),p=e._getPixelRatio(u),d=p;s.width=o*d,s.height=i*d,u.scale(d,d);var h={scale:1,canvas:s,logging:!0,width:o,height:i,allowTaint:!0,useCORS:!0};c()(a,h).then(function(){var e=l(r.a.mark((function e(n){var a,o;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=n.getContext("2d"),a.mozImageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1,a.imageSmoothingEnabled=!1,o=n.toDataURL("image/png"),console.log("screenUrl",o),t(o);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))},shareContent:function(){var e=null;return"store"===this.pageType&&(e=document.querySelector(".picture-share-content .store-picture")),"good"===this.pageType&&("good-main-picture"===this.currentTab&&(e=document.querySelector(".picture-share-content .good-main-picture")),"good-class-picture"===this.currentTab&&(e=document.querySelector(".picture-share-content .picture-content"))),e}},computed:{},watch:{show:{handler:function(e){this.showModal=e,e&&this.init()},immediate:!0},showModal:{handler:function(e){e||this.$emit("update:show",!1)},immediate:!0}}},m=g,f=n("2877"),v=Object(f["a"])(m,a,o,!1,null,null,null);t["default"]=v.exports}}]);
//# sourceMappingURL=chunk-0ae0a366.16415d23.js.map