{"version":3,"sources":["webpack:///./src/components/picture-share/picture-share.vue?d877","webpack:///src/components/picture-share/picture-share.vue","webpack:///./src/components/picture-share/picture-share.vue?8410","webpack:///./src/components/picture-share/picture-share.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","model","value","callback","$$v","showModal","expression","class","full","currentTab","_v","$cdnImageUrl","on","$event","stopPropagation","closeModal","apply","arguments","pageType","_e","noSpu","randomkey","savePicture","staticRenderFns","components","props","show","Boolean","data","Date","now","created","mounted","beforeDestroy","methods","init","$route","name","console","log","shareMessage","_getPixelRatio","backingStore","window","devicePixelRatio","_html2canvas","Promise","canvas2","width","scale","height","ctx","canvas","logging","allowTaint","useCORS","shareContent","dom","document","querySelector","computed","watch","handler","val","immediate","$emit","component"],"mappings":"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","file":"js/chunk-0ae0a366.16415d23.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('van-popup',{staticClass:\"picture-share\",attrs:{\"get-container\":\"#app-warp\",\"position\":\"bottom\"},model:{value:(_vm.showModal),callback:function ($$v) {_vm.showModal=$$v},expression:\"showModal\"}},[(_vm.showModal)?_c('div',{staticClass:\"picture-share-content\",class:{full:_vm.currentTab!=='good-class-picture'}},[_c('div',{staticClass:\"title-line\"},[_vm._v(\" 画报分享 \"),_c('img',{staticClass:\"close-icon\",attrs:{\"src\":(_vm.$cdnImageUrl + \"/common/control-close.png\"),\"alt\":\"\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.closeModal.apply(null, arguments)}}})]),(_vm.pageType==='store')?_c('store-picture'):_vm._e(),(_vm.pageType==='good')?_c('div',{staticClass:\"switch-tab\",class:{'no-spu':_vm.noSpu}},[_c('van-tabs',{attrs:{\"color\":\"#2878FF\"},model:{value:(_vm.currentTab),callback:function ($$v) {_vm.currentTab=$$v},expression:\"currentTab\"}},[_c('van-tab',{attrs:{\"title\":\"商品主图\",\"name\":\"good-main-picture\"}},[_c('good-main-picture',{attrs:{\"randomkey\":_vm.randomkey}})],1),_c('van-tab',{attrs:{\"title\":\"商品规格分类\",\"name\":\"good-class-picture\"}},[_c('good-class-picture')],1)],1)],1):_vm._e(),_c('div',{staticClass:\"save-btn\",on:{\"click\":function($event){$event.stopPropagation();return _vm.savePicture.apply(null, arguments)}}},[_vm._v(\"保存图片\")])],1):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <van-popup v-model=\"showModal\" get-container=\"#app-warp\" position=\"bottom\" class=\"picture-share\">\n    <div v-if=\"showModal\" class=\"picture-share-content\" :class=\"{full:currentTab!=='good-class-picture'}\">\n      <div class=\"title-line\">\n        画报分享\n        <img :src=\"`${$cdnImageUrl}/common/control-close.png`\" class=\"close-icon\" alt=\"\" @click.stop=\"closeModal\">\n      </div>\n      <store-picture v-if=\"pageType==='store'\"></store-picture>\n      <div v-if=\"pageType==='good'\" class=\"switch-tab\" :class=\"{'no-spu':noSpu}\">\n        <van-tabs v-model=\"currentTab\" color=\"#2878FF\">\n          <van-tab title=\"商品主图\" name=\"good-main-picture\">\n            <good-main-picture :randomkey='randomkey'></good-main-picture>\n          </van-tab>\n          <van-tab title=\"商品规格分类\" name=\"good-class-picture\">\n            <good-class-picture ></good-class-picture>\n          </van-tab>\n        </van-tabs>\n      </div>\n      <div class=\"save-btn\" @click.stop=\"savePicture\">保存图片</div>\n    </div>\n  </van-popup>\n</template>\n\n<script>\nimport html2canvas from 'html2canvas'\nimport './picture-share.scss'\nconst goodClassPicture = () => import('./components/good-class-picture')\nconst goodMainPicture = () => import('./components/good-main-picture')\nconst storePicture = () => import('./components/store-picture')\n\nexport default {\n  components: { goodClassPicture, goodMainPicture, storePicture },\n  props: {\n    show: Boolean\n  },\n  data () {\n    return {\n      showModal: false,\n      currentTab: 'good-main-picture',\n      pageType: '',\n      noSpu: true,\n      randomkey: Date.now(),\n    }\n  },\n  created () {},\n  mounted () {},\n  beforeDestroy () {},\n  methods: {\n    closeModal () {\n      this.showModal = false\n    },\n    init () {\n      if (this.$route.name === 'shopDetail') {\n        this.pageType = 'store'\n      }\n      if (this.$route.name === 'detail') {\n        this.pageType = 'good'\n        const shareMessage = this.$util.strJSONParse(localStorage.getItem('shareMessage'))\n        console.log('localStorage shareMessage', shareMessage)\n        if (shareMessage) {\n          this.noSpu = (shareMessage.spuList.length <= 1)\n        }\n      }\n    },\n    async savePicture () {\n      const shareContent = this.shareContent()\n      if (!shareContent) { return }\n      // shareContent.style.border = '.02rem solid #eeeeee'\n      const imgUrl = await this._html2canvas()\n      // shareContent.style.border = ''\n      console.log('savePicture', imgUrl.length)\n\n      if (this.$util.isHaierApp()) {\n        this.$util.uplusSaveImage(imgUrl).then(res => {\n          if (res) {\n            this.$toast({\n              type: 'success',\n              message: '保存成功',\n              duration: 1500,\n              className: 'picture-toast-class'\n            })\n          } else {\n            console.log('uplusSaveImage error:', res)\n            this.$toast({\n              type: 'fail',\n              message: '保存失败',\n              duration: 1500,\n              className: 'picture-toast-class'\n            })\n          }\n        })\n      } else if (this.$util.isSgRn()) {\n        window.postMessage(JSON.stringify({\n          type: 'saveQrCode',\n          data: { qrCodeUrl: imgUrl }\n        }))\n      } else {\n        const a = document.createElement('a') // 创建一个a节点插入的document\n        const event = new MouseEvent('click') // 模拟鼠标click点击事件\n        a.download = Date.now() // 设置a节点的download属性值\n        a.href = imgUrl // 将图片的src赋值给a节点的href\n        a.dispatchEvent(event)\n      }\n      this.randomkey = Date.now()\n    },\n    _getPixelRatio(context) {\n      var backingStore =\n        context.backingStorePixelRatio ||\n        context.webkitBackingStorePixelRatio ||\n        context.mozBackingStorePixelRatio ||\n        context.msBackingStorePixelRatio ||\n        context.oBackingStorePixelRatio ||\n        context.backingStorePixelRatio ||\n        1\n      return (window.devicePixelRatio || 1) / backingStore\n    },\n    _html2canvas() {\n      return new Promise((resolve, reject) => {\n        // 创建一个新的canvas\n        const _canvas = this.shareContent()\n        // 此处用于解决截图不清晰问题，将生成的canvas放大，然后再填充到原有的容器中就会清晰\n        const width = _canvas.offsetWidth\n        const height = _canvas.offsetHeight\n        const canvas2 = document.createElement('canvas')\n        const ctx = canvas2.getContext('2d')\n        const ratio = this._getPixelRatio(ctx)\n        const scale = ratio\n        canvas2.width = width * scale\n        canvas2.height = height * scale\n        ctx.scale(scale, scale)\n        const opts = {\n          scale: 1,\n          canvas: canvas2,\n          logging: true, // 日志开关，便于查看html2canvas的内部执行流程\n          width,\n          height,\n          allowTaint: true,\n          useCORS: true, // 【重要】开启跨域配置\n        }\n        html2canvas(_canvas, opts).then(async canvas => {\n          const context = canvas.getContext('2d')\n          // 【重要】关闭抗锯齿\n          context.mozImageSmoothingEnabled = false\n          context.webkitImageSmoothingEnabled = false\n          context.msImageSmoothingEnabled = false\n          context.imageSmoothingEnabled = false\n\n          const screenUrl = canvas.toDataURL('image/png')\n          console.log('screenUrl', screenUrl)\n          resolve(screenUrl)\n        })\n      })\n    },\n    shareContent () {\n      let dom = null\n      if (this.pageType === 'store') {\n        dom = document.querySelector('.picture-share-content .store-picture')\n      }\n      if (this.pageType === 'good') {\n        if (this.currentTab === 'good-main-picture') {\n          dom = document.querySelector(`.picture-share-content .good-main-picture`)\n        }\n        if (this.currentTab === 'good-class-picture') {\n          dom = document.querySelector(`.picture-share-content .picture-content`)\n        }\n      }\n      return dom\n    }\n  },\n  computed: {},\n  watch: {\n    show: {\n      handler (val) {\n        this.showModal = val\n        val && this.init()\n      },\n      immediate: true\n    },\n    showModal: {\n      handler (val) {\n        if (!val) {\n          this.$emit('update:show', false)\n        }\n      },\n      immediate: true\n    }\n  }\n}\n</script>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./picture-share.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./picture-share.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./picture-share.vue?vue&type=template&id=c99ff622&\"\nimport script from \"./picture-share.vue?vue&type=script&lang=js&\"\nexport * from \"./picture-share.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}